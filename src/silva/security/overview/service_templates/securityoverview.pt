<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      metal:use-macro="context/@@standard_macros/page">
  <body>
    <div metal:fill-slot="body">
      <style>
        .hilite { background-color: yellow; }
      </style>
      <form action="." tal:attributes="action view/form_path" method="get"
            enctype="multipart/form-data">

        <h2 tal:condition="view/label"
            tal:content="view/label">Label</h2>

        <p tal:condition="view/description"
           tal:content="view/description">Description</p>

        <p class="form-status"
           tal:condition="view/status"
           tal:content="view/status">Status</p>

        <p class="form-error"
           tal:condition="view/errors">
          There were errors:
          <tal:error tal:repeat="error view/formErrors">
            <br />
            <span tal:replace="error/title" />
          </tal:error>
        </p>

        <table class="fields"
               tal:condition="view/fieldWidgets">
          <tr class="field" tal:repeat="widget view/fieldWidgets">
            <td>
              <label class="field-label form-label" for="#"
                     tal:attributes="for widget/htmlId"
                     tal:content="widget/title">
                Label
              </label>
              <span class="field-required form-optional"
                    tal:condition="widget/required">(required)</span>
            </td>
            <td>
              <tal:error tal:define="error widget/error"
                         tal:condition="error">
                <span class="field-error"
                      tal:content="error/title">
                  Error
                </span>
                <br />
              </tal:error>
            </td>
            <td>
              <tal:widget tal:content="structure widget/render" />
            </td>
            <td>
              <tal:description tal:condition="widget/description">
                <span class="field-description form-help"
                      tal:content="widget/description">
                  </span><br />
              </tal:description>
            </td>
          </tr>
        </table>
      
        <div class="actions"
             tal:condition="view/actionWidgets">
          <div class="action" tal:repeat="widget view/actionWidgets">
            <tal:widget tal:content="structure widget/render" />
          </div>
        </div>

      </form>

      <div class="message" tal:condition="python: not(view.entries)">
        No information available.
      </div>

      <tal:block tal:condition="view/entries">

        <div class="nav" tal:content="structure view/batch" />

        <table style="width: 100%" class="results">
          <tr class="list-header">
            <td><div class="list-item">user</div></td>
            <td><div class="list-item">role</div></td>
          </tr>
          <tal:block tal:repeat="entry view/entries">
            <tr class="row-hilite">
              <td style="border-top: 1px solid #ccc" colspan="2">
                <a 
                   tal:attributes="href python: view.smi_security_url(entry)"
                   tal:content="python: '/'.join(entry.getPhysicalPath())" />
              </td>
            </tr>
            <tal:block tal:repeat="data python: view.unpack_entry(entry)">
              <tr class="row-normal">
                <td>
                  <span
                     tal:attributes="class python:'user' in data['hilite'] and 'hilite' or ''"
                     tal:content="python:data['user']" />
                </td>
                <td>
                  <span
                     tal:attributes="class python:'role' in data['hilite'] and 'hilite' or ''"
                     tal:content="python:data['role']" />
                </td>
              </tr>
            </tal:block>
          </tal:block>
        </table>

        <div class="nav" tal:content="structure view/batch" />
      </tal:block>
    </div>
  </body>
</html>
